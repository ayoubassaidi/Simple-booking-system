{% extends "dashboard_base.html" %}

{% block dashboard_content %}

<div class="main-section">
    <h4 class="section-title">
        <i class="bi bi-person-circle"></i> My Profile
    </h4>

    <!-- Profile Header Card -->
    <div class="profile-header-card">
        <div class="profile-avatar-section">
            <div class="profile-avatar">
                <i class="bi bi-person-fill"></i>
            </div>
            <div class="profile-header-info">
                <h3>{{ user.username }}</h3>
                <p class="user-type-badge-profile">
                    {% if user_profile.user_type == 'provider' %}
                        <i class="bi bi-briefcase-fill"></i> Service Provider
                    {% else %}
                        <i class="bi bi-person-circle"></i> User
                    {% endif %}
                </p>
                <p class="member-since">
                    <i class="bi bi-calendar-check"></i> Member since {{ user.date_joined|date:"F Y" }}
                </p>
            </div>
        </div>
    </div>

    <!-- Profile Form -->
    <div class="profile-form-card">
        <form method="post">
            {% csrf_token %}

            <h5 class="form-section-title">
                <i class="bi bi-info-circle-fill"></i> Basic Information
            </h5>

            <div class="row g-3">
                <div class="col-md-6">
                    <div class="form-group-profile">
                        <label><i class="bi bi-person"></i> Username</label>
                        <input type="text" class="form-control-profile" value="{{ user.username }}" disabled>
                        <small class="form-help-text">Username cannot be changed</small>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group-profile">
                        <label><i class="bi bi-envelope"></i> Email</label>
                        <input type="email" name="email" class="form-control-profile" value="{{ user.email }}" placeholder="your.email@example.com">
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group-profile">
                        <label><i class="bi bi-person-badge"></i> First Name</label>
                        <input type="text" name="first_name" class="form-control-profile" value="{{ user.first_name }}" placeholder="Enter your first name">
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group-profile">
                        <label><i class="bi bi-person-badge-fill"></i> Last Name</label>
                        <input type="text" name="last_name" class="form-control-profile" value="{{ user.last_name }}" placeholder="Enter your last name">
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group-profile">
                        <label><i class="bi bi-telephone"></i> Phone Number</label>
                        <input type="tel" name="phone_number" class="form-control-profile" value="{{ user_profile.phone_number }}" placeholder="+31 6 12345678">
                    </div>
                </div>

                {% if user_profile.user_type == 'user' %}
                    <!-- User-specific fields -->
                    <div class="col-md-6">
                        <div class="form-group-profile">
                            <label><i class="bi bi-calendar-event"></i> Birthday</label>
                            <input type="text" 
                                name="birthday" 
                                id="birthday" 
                                class="form-control-profile"
                                value="{{ user_profile.birthday|date:'Y-m-d' }}"
                                placeholder="Select your birthday"
                                readonly>
                            <small class="text-danger" id="birthday-error" style="display:none;">Birthday must be in the past.</small>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group-profile">
                            <label><i class="bi bi-geo-alt"></i> Address</label>
                            <input type="text" name="address" class="form-control-profile" value="{{ user_profile.address }}" placeholder="Enter your full address">
                        </div>
                    </div>

                {% else %}
                    <!-- Provider-specific fields -->
                    <div class="col-md-6">
                        <div class="form-group-profile">
                            <label><i class="bi bi-geo-alt"></i> City</label>
                            <input type="text" name="city" class="form-control-profile" value="{{ user_profile.city }}" placeholder="City where you provide services">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group-profile">
                            <label><i class="bi bi-briefcase"></i> Service Type</label>
                            <input type="text" name="service_type" class="form-control-profile" value="{{ user_profile.service_type }}" placeholder="e.g., Hair Styling, Plumbing">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group-profile">
                            <label><i class="bi bi-building"></i> KVK Number</label>
                            <input type="text" name="kvk_number" class="form-control-profile" value="{{ user_profile.kvk_number }}" placeholder="Chamber of Commerce number">
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="form-group-profile">
                            <label><i class="bi bi-card-text"></i> Bio</label>
                            <textarea name="bio" class="form-control-profile" rows="4" placeholder="Tell us about your services and experience">{{ user_profile.bio }}</textarea>
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="profile-form-actions">
                <button type="submit" class="btn-save-profile">
                    <i class="bi bi-check-circle"></i>
                    <span>Save Changes</span>
                </button>
                <a href="{% url 'dashboard' %}" class="btn-cancel-profile">
                    <i class="bi bi-x-circle"></i>
                    <span>Cancel</span>
                </a>
            </div>
        </form>
    </div>

    <!-- Account Security Section -->
    <div class="security-section-card">
        <h5 class="form-section-title">
            <i class="bi bi-shield-lock-fill"></i> Account Security
        </h5>

        <div class="security-info-grid">
            <div class="security-info-item">
                <div class="security-icon">
                    <i class="bi bi-key-fill"></i>
                </div>
                <div class="security-content">
                    <h6>Password</h6>
                    <p>Last changed: Never</p>
                    <a href="#" class="security-link">Change Password</a>
                </div>
            </div>

            <div class="security-info-item">
                <div class="security-icon">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="security-content">
                    <h6>Last Login</h6>
                    <p>{{ user.last_login|date:"F d, Y g:i A" }}</p>
                </div>
            </div>

            <div class="security-info-item">
                <div class="security-icon">
                    <i class="bi bi-shield-check"></i>
                </div>
                <div class="security-content">
                    <h6>Account Status</h6>
                    <p><span class="badge-active">Active</span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Flatpickr CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const birthdayInput = document.getElementById('birthday');
    if (!birthdayInput) return;

    // Get yesterday's date
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);

    // Initialize Flatpickr
    flatpickr(birthdayInput, {
        dateFormat: "Y-m-d",
        maxDate: yesterday,
        allowInput: false,
        disableMobile: false,
        onChange: function(selectedDates, dateStr, instance) {
            document.getElementById('birthday-error').style.display = 'none';
        }
    });
});
</script>
{% endblock %}


